/* =============================
   Control de trabajo en SAP
   ============================= */
/* Clientes */
CREATE TABLE OCRD(
  CardCode VARCHAR(15) PRIMARY KEY,
  CardName VARCHAR(100),
  GroupNum INT,
  phone1 VARCHAR(30),
  `e-mail` VARCHAR(254),
  Active VARCHAR(1) NOT NULL
);

/*Marcas*/
CREATE TABLE OITB(
  ItmsGrpCod VARCHAR(50) PRIMARY KEY,
  ItmsGrpNam VARCHAR(100),
  Locked CHAR(1),
  Object VARCHAR(20)
);

/*Descuentos por cliente*/
CREATE TABLE OEDG(
  AbsEntry INT PRIMARY KEY,
  Type CHAR(1),
  ObjType VARCHAR(20),
  ObjCode VARCHAR(15),
  FOREIGN KEY(ObjCode) REFERENCES OCRD(CardCode)
);

/*Detalle de descuentos por grupo de artículos*/
CREATE TABLE EDG1(
  AbsEntry INT NOT NULL,
  ObjType VARCHAR(20) NOT NULL,
  ObjKey VARCHAR(50) NOT NULL,
  Disctype CHAR(1),
  Discount DECIMAL(19,6),
  PRIMARY KEY(AbsEntry, ObjType, ObjKey),
  FOREIGN KEY(AbsEntry) REFERENCES OEDG(AbsEntry),
  FOREIGN KEY(ObjKey) REFERENCES OITB(ItmsGrpCod)
);

/* Vendedores */
CREATE TABLE OSLP(
  SlpCode INT PRIMARY KEY,
  SlpName VARCHAR(155) NOT NULL,
  Active CHAR(1)
);

/* Direcciones de clientes */
CREATE TABLE CRD1(
  CardCode VARCHAR(15) NOT NULL,
  Address VARCHAR(254) NOT NULL,
  Street VARCHAR(100),
  Block VARCHAR(100),
  ZipCode VARCHAR(20),
  City VARCHAR(100),
  Country VARCHAR(3),
  County VARCHAR(100),
  State VARCHAR(3),
  AdresType VARCHAR(100) NOT NULL,
  PRIMARY KEY (CardCode, Address, AdresType),
  FOREIGN KEY (CardCode) REFERENCES OCRD(CardCode)
);

/*Monedas*/
CREATE TABLE OCRN(
  Currency_ID INT AUTO_INCREMENT PRIMARY KEY,
  Currency VARCHAR(3) UNIQUE NOT NULL,
  CurrName VARCHAR(100) NOT NULL
); 

/* Listas de precios */
CREATE TABLE OPLN(
  ListNum INT PRIMARY KEY,
  ListName VARCHAR(32)
);

/* Tipos de cambio */
CREATE TABLE ORTT(
  RateDate DATE,
  Currency_ID INT NOT NULL,
  Rate DECIMAL(19,6),
  PRIMARY KEY(RateDate, Currency_ID),
  FOREIGN KEY(Currency_ID) REFERENCES OCRN(Currency_ID)
);

/* Imagenes de productos */
CREATE TABLE Imagenes(
  Id_imagen BIGINT PRIMARY KEY AUTO_INCREMENT,
  Ruta_imagen VARCHAR(254)
);

/* Productos */
CREATE TABLE OITM(
  ItemCode VARCHAR(50) PRIMARY KEY,
  ItemName VARCHAR(254),
  FrgnName VARCHAR(254),
  SalUnitMsr VARCHAR(100),
  Id_imagen BIGINT NOT NULL,
  Active CHAR(1) NOT NULL,
  ItmsGrpCod VARCHAR(50),
  FOREIGN KEY (ItmsGrpCod) REFERENCES OITB(ItmsGrpCod),
  FOREIGN KEY (Id_imagen) REFERENCES Imagenes(Id_imagen)
);

/* Precios de productos */
CREATE TABLE ITM1(
  ItemCode VARCHAR(50) NOT NULL,
  PriceList INT NOT NULL,
  Price DECIMAL(19,6),
  Currency_ID INT NOT NULL,
  PRIMARY KEY(ItemCode, PriceList),
  FOREIGN KEY(ItemCode) REFERENCES OITM(ItemCode),
  FOREIGN KEY(PriceList) REFERENCES OPLN(ListNum),
  FOREIGN KEY(Currency_ID) REFERENCES OCRN(Currency_ID)
);

/* Cotizaciones */
CREATE TABLE OQUT(
    DocEntry INT AUTO_INCREMENT PRIMARY KEY,
    CardCode VARCHAR(15) NOT NULL,
    DocDate DATE,
    DocDueDate DATE,
    CardName VARCHAR(100),
    SlpCode INT,
    Phone1 VARCHAR(20),
    E_Mail VARCHAR(100),
    DocCur VARCHAR(3),
    ShipToCode VARCHAR(50),
    PayToCode VARCHAR(50),
    Address VARCHAR(254),
    Address2 VARCHAR(254),
    TotalSinPromo DECIMAL(19,6),
    Descuento DECIMAL(19,6),
    Subtotal DECIMAL(19,6),
    IVA DECIMAL(19,6),
    Total DECIMAL(19,6),
    comment VARCHAR(254),
    FOREIGN KEY (CardCode) REFERENCES OCRD(CardCode),
    FOREIGN KEY (SlpCode) REFERENCES OSLP(SlpCode)
);

/* Líneas de cotización */
CREATE TABLE QUT1(
  DocEntry INT NOT NULL,
  LineNum INT NOT NULL,
  ObjType VARCHAR(20) default 23,
  ItemCode VARCHAR(50) NOT NULL,
  U_Dscr VARCHAR(250),
  unitMsr2 VARCHAR(100),
  Price DECIMAL(19,6),
  DiscPrcnt DECIMAL(19,6),
  Quantity DECIMAL(19,6),
  Id_imagen BIGINT,
  ivaPorcentaje VARCHAR(10),
  PRIMARY KEY (DocEntry, LineNum),
  FOREIGN KEY (DocEntry) REFERENCES OQUT(DocEntry),
  FOREIGN KEY (ItemCode) REFERENCES OITM(ItemCode),
  FOREIGN KEY (Id_imagen) REFERENCES Imagenes(Id_imagen)
);

/*Pedidos*/
CREATE TABLE ORDR(
    DocEntry INT AUTO_INCREMENT PRIMARY KEY,
    CardCode VARCHAR(15) NOT NULL,
    DocDate DATE,
    DocDueDate DATE,
    CardName VARCHAR(100),
    SlpCode INT,
    Phone1 VARCHAR(20),
    E_Mail VARCHAR(100),
    DocCur VARCHAR(3),
    ShipToCode VARCHAR(50),
    PayToCode VARCHAR(50),
    Address VARCHAR(254),
    Address2 VARCHAR(254),
    TotalSinPromo DECIMAL(19,6),
    Descuento DECIMAL(19,6),
    Subtotal DECIMAL(19,6),
    IVA DECIMAL(19,6),
    Total DECIMAL(19,6),
    comment VARCHAR(254),
    FOREIGN KEY (CardCode) REFERENCES OCRD(CardCode),
    FOREIGN KEY (SlpCode) REFERENCES OSLP(SlpCode)
);

/*Líneas de pedidos*/
CREATE TABLE RDR1 (
  DocEntry INT NOT NULL,
  LineNum INT NOT NULL,
  ObjType VARCHAR(20) default 23,
  ItemCode VARCHAR(50) NOT NULL,
  U_Dscr VARCHAR(250),
  unitMsr2 VARCHAR(100),
  Price DECIMAL(19,6),
  DiscPrcnt DECIMAL(19,6),
  Quantity DECIMAL(19,6),
  Id_imagen BIGINT,
  TargetType INT,
  TrgetEntry INT,
  BaseRef VARCHAR(16),
  BaseType INT default 23,
  BaseEntry INT,
  ivaPorcentaje VARCHAR(10),
  PRIMARY KEY (DocEntry, LineNum),
  FOREIGN KEY (DocEntry) REFERENCES ORDR(DocEntry),
  FOREIGN KEY (ItemCode) REFERENCES OITM(ItemCode),
  FOREIGN KEY (Id_imagen) REFERENCES Imagenes(Id_imagen),
  FOREIGN KEY (BaseEntry) REFERENCES OQUT(DocEntry)
);

/* =============================
   CONFIGURACION DEL SISTEMA FUERA DE SAP
   ============================= */
CREATE TABLE roles (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50)
);

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100),
    email VARCHAR(100),
    password VARCHAR(255),
    activo BOOLEAN,
    rol_id BIGINT UNSIGNED NOT NULL,                  
    FOREIGN KEY (rol_id) REFERENCES roles(id)
);

CREATE TABLE configuracion(
  id INT AUTO_INCREMENT PRIMARY KEY,
  iva INT ,
  ruta_logo VARCHAR(255),
  nombre_empresa VARCHAR(255),
  calle VARCHAR(150),
  colonia VARCHAR (50),
  CP VARCHAR (10),
  ciudad VARCHAR (30),
  telefono VARCHAR(15),
  pais VARCHAR(30),
  MonedaPrincipal INT,
  FOREIGN KEY(MonedaPrincipal) REFERENCES OCRN(Currency_ID)
);